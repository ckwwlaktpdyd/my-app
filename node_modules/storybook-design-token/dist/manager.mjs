import { addons, types, useParameter } from 'storybook/manager-api';
import { AddonPanel, ScrollArea, Tabs, ActionBar, WithTooltip, TooltipNote, TooltipMessage, Button } from 'storybook/internal/components';
import i, { useState, useMemo, useEffect, useRef, useCallback, useLayoutEffect } from 'react';
import { SearchIcon, CopyIcon, InfoIcon, CrossIcon, CloseIcon } from '@storybook/icons';
import { styled, keyframes } from 'storybook/theming';
import { createPortal } from 'react-dom';
import { useLocalStorage, useCopyToClipboard } from '@uidotdev/usehooks';
import { transparentize } from 'polished';
import { useVirtualizer } from '@tanstack/react-virtual';

var V=({button:e,value:t})=>{let[r,n]=useCopyToClipboard();return i.createElement("span",{onClick:()=>n(t)},e)};var ee=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:r.color.secondary,borderRadius:2,height:32,width:"100%"})),[e]);return i.createElement("div",{style:{overflow:"hidden"}},i.createElement(t,{style:{animation:e.value}}))};var oe=({token:e})=>{let t=useMemo(()=>styled.div(()=>({border:e.value,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var ie=({token:e})=>{let t=useMemo(()=>styled.div(()=>({minHeight:32,height:32,overflow:"auto"})),[]),r=useMemo(()=>styled.div(({theme:n})=>({background:n.color.secondary,borderRadius:e.value,minHeight:`calc(${e.value} * 2)`,minWidth:`calc(${e.value} * 2)`,overflow:"hidden",width:"100%"})),[e]);return i.createElement(t,null,i.createElement(r,null))};var se=({token:e})=>{let t=useMemo(()=>styled.div(()=>({background:e.value,borderRadius:2,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var ae=({token:e})=>{let t=keyframes`
    0% {
      transform: scaleX(0);
    }
    50% {
      transform: scaleX(1);
    }
    100% {
      transform: scaleX(0);
    }
  `,r=useMemo(()=>styled.div(({theme:n})=>({animation:`${t} 2s infinite`,animationTimingFunction:e.value,background:n.color.secondary,borderRadius:2,height:32,transformOrigin:"left",width:"100%"})),[e]);return i.createElement(r,null)};var le=()=>{let e=useMemo(()=>styled.div(({theme:t})=>({alignItems:"center",color:t.color.mediumdark,display:"flex",height:32,width:"100%"})),[]);return i.createElement(e,null,"No preview available.")};var pe=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontFamily:e.value,width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var me=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontSize:e.value,height:e.value,lineHeight:1,whiteSpace:"nowrap",width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var de=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontWeight:e.value,width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var ue=({token:e})=>{let t=useMemo(()=>styled.div(()=>({height:"100%",lineHeight:e.value,overflow:"auto",width:"100%"})),[e]);return i.createElement(t,null,"Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ipsam veniam eum dicta.")};var ce=({token:e})=>{let t=useMemo(()=>styled.div(()=>({height:"100%",letterSpacing:e.value,overflow:"auto",width:"100%"})),[e]);return i.createElement(t,null,"Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ipsam veniam eum dicta.")};var he=({token:e})=>{let t=useMemo(()=>styled.div(()=>({display:"flex",height:"2rem",width:"100%"})),[e]),r=useMemo(()=>styled.div(()=>({backgroundColor:"#000",borderRadius:"50%",height:"2rem",opacity:e.value,width:"2rem","&:nth-of-type(2)":{transform:"translateX(-50%)"}})),[e]);return i.createElement(t,null,i.createElement(r,null),i.createElement(r,null))};var ye=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:"#fff",boxShadow:e.value,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var Te=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:r.color.secondary,borderRadius:2,height:32,width:e.value})),[e]);return i.createElement(t,null)};var be=({token:e})=>{let t=useMemo(()=>styled.div(()=>({alignItems:"center",display:"flex",height:32,width:"100%"})),[e]);return i.createElement(t,{dangerouslySetInnerHTML:{__html:e.value}})};function xe({token:e}){let t=useMemo(()=>styled.img(()=>({maxHeight:32,maxWidth:"100%",backgroundSize:"contain"})),[e]);return i.createElement(t,{src:`data:image/png;base64, ${e.value}`})}var F=({token:e,presenters:t})=>{let r=e.presenter,n={...Fo,...t||{}},a=r!=null?n[r]:le;return i.createElement(a,{token:e})},Fo={[`${"Animation"}`]:ee,[`${"Border"}`]:oe,[`${"BorderRadius"}`]:ie,[`${"Color"}`]:se,[`${"Easing"}`]:ae,[`${"FontFamily"}`]:pe,[`${"FontSize"}`]:me,[`${"FontWeight"}`]:de,[`${"LineHeight"}`]:ue,[`${"LetterSpacing"}`]:ce,[`${"Opacity"}`]:he,[`${"Shadow"}`]:ye,[`${"Spacing"}`]:Te,[`${"Svg"}`]:be,[`${"Image"}`]:xe};var O=styled.input(({theme:e})=>({appearance:"none",background:e.input.background,border:"0 none",borderRadius:e.input.borderRadius,boxShadow:`${e.input.border} 0 0 0 1px inset`,boxSizing:"inherit",color:e.input.color||"inherit",display:" block",fontSize:e.typography.size.s2-1,lineHeight:"20px",margin:" 0",padding:"6px 10px",position:"relative",transition:"all 200ms ease-out",width:"100%","&:focus":{boxShadow:`${e.color.secondary} 0 0 0 1px inset`,outline:"none"},"&[disabled]":{cursor:"not-allowed",opacity:.5},"&:-webkit-autofill":{WebkitBoxShadow:`0 0 0 3em ${e.color.lightest} inset`},"::placeholder":{color:e.color.mediumdark}}));var w=({children:e,onClick:t})=>{let r=useMemo(()=>styled.button(({theme:n})=>({alignItems:"center",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"inline-flex",height:18,justifyContent:"center",marginLeft:4,padding:0,verticalAlign:"middle",width:18,color:n.color.defaultText,"&:hover":{color:n.color.secondary},"> svg":{height:13,position:"relative",top:-1,width:13}})),[]);return i.createElement(r,{onClick:t},e)};var z=({onValueChange:e,readonly:t,token:r})=>{let[n,a]=useState(r.rawValue),p=useMemo(()=>styled.div(({})=>({position:"relative"})),[]),f=useMemo(()=>styled.span(({})=>({position:"absolute",right:8,top:"50%",transform:"translate3d(0, -50%, 0)"})),[]),s=useMemo(()=>styled.span(({})=>({overflow:"hidden",wordBreak:"break-all",WebkitLineClamp:3,WebkitBoxOrient:"vertical",display:"-webkit-box"})),[]),g=r.sourceType!=="CSS"&&r.sourceType!=="SVG";return useEffect(()=>{let c=document.querySelector("#storybook-preview-iframe")?.contentWindow?.document.documentElement;c!=null&&(r.rawValue!==n?c.style.setProperty(r.name,n):c.style.setProperty(r.name,r.rawValue));},[n]),i.createElement(p,null,g&&i.createElement(s,{title:n},n),!g&&i.createElement(O,{readOnly:t,onChange:m=>{let c=m.target.value;a(c),e(c);},value:n}),!g&&r.rawValue!==n&&i.createElement(f,null,i.createElement(w,{onClick:()=>{a(r.rawValue),e(r.rawValue);}},i.createElement(CloseIcon,null))))};var $=(e,t,r)=>useMemo(()=>{let n=e.flatMap(s=>s.tokens),a=r?n.filter(s=>s.sourcePath.includes(r)):n;return (t?a.filter(s=>t.includes(s.name)):a).filter((s,g,m)=>m.findIndex(c=>c.name===s.name)===g)},[e,t,r]);var qo=keyframes({from:{opacity:0,transform:"translateY(5px)"},to:{opacity:1,transform:"translateY(0)"}}),D=styled.div(({theme:e})=>({position:"absolute",background:e.background.content,border:`1px solid ${e.color.border}`,borderRadius:e.borderRadius,padding:"12px 15px",boxShadow:`0 4px 12px ${transparentize(.85,e.color.darker)}`,color:e.color.defaultText,fontFamily:e.typography.fonts.base,fontSize:e.typography.size.s2,minWidth:150,maxWidth:300,zIndex:1e3,animation:`${qo} 0.2s ease-out`,"& > div:first-child":{fontWeight:e.typography.weight.bold,marginBottom:8,color:e.color.darkest},"& > ul":{margin:0,padding:0,listStyle:"none",maxHeight:200,overflowY:"auto","& > li":{padding:"4px 8px",borderRadius:e.borderRadius/2,color:transparentize(.1,e.color.defaultText),background:transparentize(.95,e.color.medium),marginBottom:4,transition:"background 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","&:hover":{background:transparentize(.85,e.color.medium)},"&:last-child":{marginBottom:0}}}}));function G({usageMap:e,getElementRef:t,getTokenName:r}){let[n,a]=useState(null),p=useRef(null),f=useRef(null),s=useCallback((m,c)=>{let h=r(c);if(!e)return;m.preventDefault();let P=t(c);if(!P)return;let b=P.getBoundingClientRect(),x=b.bottom+window.scrollY+5,E=b.left+window.scrollX;a({top:x,left:E,tokenName:h}),p.current&&clearTimeout(p.current);},[e,t,r]),g=useCallback(()=>{a(null),p.current&&clearTimeout(p.current);},[]);return useLayoutEffect(()=>{let m=h=>{f.current&&!f.current.contains(h.target)&&g();},c=h=>{if(!n)return;let P=h.target;f.current&&!f.current.contains(P)&&(p.current&&clearTimeout(p.current),p.current=window.setTimeout(g,2e3));};return document.addEventListener("click",m),document.addEventListener("scroll",c,!0),()=>{document.removeEventListener("click",m),document.removeEventListener("scroll",c,!0);}},[n,g]),{popup:n,popupRef:f,handleContextMenu:s,closePopup:g}}var we=({categories:e,padded:t=!0,readonly:r,showValueColumn:n=!0,pageSize:a=50,presenters:p,filterNames:f,usageMap:s,theme:g})=>{let[m,c]=useState({}),[h,P]=useState(0),b=useRef(new Map),{popup:x,popupRef:E,handleContextMenu:B}=G({usageMap:s,getElementRef:o=>b.current.get(o.name)||null,getTokenName:o=>o.name}),M=useMemo(()=>styled.div(()=>({display:"grid",columnGap:12,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",padding:t?15:void 0,rowGap:12})),[]),k=useMemo(()=>styled.div(({theme:o})=>({boxShadow:"rgb(0 0 0 / 10%) 0px 1px 3px 1px, rgb(0 0 0 / 7%) 0px 0px 0px 1px",borderRadius:4,color:o.color.defaultText,fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,padding:12,overflow:"hidden",":hover":{backgroundColor:o.background.hoverable},"> *:not(:last-child)":{marginBottom:8},svg:{maxWidth:"100%",maxHeight:"100%"}})),[]),C=styled.span(({theme:o})=>({fontFamily:o.typography.fonts.mono,fontWeight:o.typography.weight.bold,fontSize:o.typography.size.s1})),y=useMemo(()=>styled.div(({theme:o})=>({alignItems:"center",color:o.color.defaultText,display:"flex",fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,justifyContent:"space-between",paddingRight:t?15:void 0,paddingBottom:t?48:void 0,paddingLeft:t?15:void 0,marginTop:8,"& > div":{display:"flex",gap:8}})),[]),v=$(e,f,g),T=useMemo(()=>Math.ceil(v.length/a),[v]);return i.createElement(i.Fragment,null,i.createElement(M,null,v.slice(h*a,h*a+a).map((o,d)=>i.createElement(k,{key:o.name+"-card-"+d,ref:u=>{u&&b.current.set(o.name,u);},onContextMenu:u=>B(u,o)},i.createElement("div",null,i.createElement(C,null,o.name),i.createElement(WithTooltip,{hasChrome:!1,tooltip:i.createElement(TooltipNote,{note:"Copy to clipboard"})},i.createElement(V,{button:i.createElement(w,null,i.createElement(CopyIcon,null)),value:o.name})),o.description&&i.createElement(WithTooltip,{tooltip:i.createElement(TooltipMessage,{desc:o.description})},i.createElement(w,null,i.createElement(InfoIcon,null)))),n&&i.createElement(z,{onValueChange:u=>{c(A=>({...A,[o.name]:u===o.rawValue?void 0:u}));},readonly:r,token:o}),i.createElement(F,{presenters:p,token:{...o,value:m[o.name]||o.value}})))),T>1&&i.createElement(y,null,i.createElement("span",null,"Page ",h+1," of ",T),i.createElement("div",null,i.createElement(Button,{disabled:h===0,onClick:()=>P(o=>Math.max(0,o-1)),tertiary:!0,small:!0},"Previous page"),i.createElement(Button,{disabled:h>=T-1,onClick:()=>P(o=>Math.min(o+1,T-1)),tertiary:!0,small:!0},"Next page"))),x&&s&&createPortal(i.createElement(D,{ref:E,style:{top:x.top,left:x.left}},s&&s[x.tokenName]?i.createElement(i.Fragment,null,i.createElement("div",null,"Used in:"),i.createElement("ul",null,s[x.tokenName].map((o,d)=>i.createElement("li",{key:d},o)))):i.createElement("div",null,"Token might be unused or global, please check")),document.body))};var Ne=({categories:e,maxHeight:t,readonly:r,showValueColumn:n=!0,presenters:a,filterNames:p,theme:f,usageMap:s})=>{let[g,m]=useState({}),[c,h]=useState(t||100),P=useRef(new Map),{popup:b,popupRef:x,handleContextMenu:E}=G({usageMap:s,getElementRef:o=>P.current.get(o.index)||null,getTokenName:o=>o.token.name}),B=useRef(null),M=useRef(null),k=$(e,p,f),C=useVirtualizer({count:k.length,getScrollElement:()=>B.current,estimateSize:useCallback(()=>49,[])}),y=useMemo(()=>styled.div(()=>({maxHeight:c?`${c+30}px`:"none",overflow:"auto",padding:"15px"})),[c]),v=useMemo(()=>styled.table(({theme:o})=>({borderCollapse:"collapse",borderSpacing:0,color:o.color.defaultText,fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,minWidth:700,tableLayout:"fixed",textAlign:"left",width:"100%","thead > tr":{display:"flex"},"tbody > tr":{borderTop:`1px solid ${o.color.mediumlight}`,display:"flex",":first-of-type":{borderTopColor:o.color.medium},":last-of-type":{borderBottom:`1px solid ${o.color.mediumlight}`},":hover":{backgroundColor:o.background.hoverable}},tr:{":hover":{backgroundColor:"rgba(0,0,0, 0.1)"}},"td, th":{border:"none !important",textOverflow:"ellipsis",verticalAlign:"middle",":nth-of-type(1)":{flexBasis:"50%",flexGrow:1,flexShrink:0},":nth-of-type(2)":{flexBasis:"25%",flexGrow:0,flexShrink:0},":nth-of-type(3)":{flexBasis:"25%",flexGrow:0,flexShrink:0}},th:{color:o.base==="light"?transparentize(.25,o.color.defaultText):transparentize(.45,o.color.defaultText),paddingBottom:12,":not(:first-of-type)":{paddingLeft:15},":not(:last-of-type)":{paddingRight:15},":last-of-type":{width:200}},td:{overflow:"hidden",paddingBottom:8,paddingTop:8,alignItems:"center",":not(:first-of-type)":{paddingLeft:15},":not(:last-of-type)":{paddingRight:15},svg:{maxWidth:"100%",maxHeight:"100%"},span:{alignItems:"center",display:"flex",height:"100%"}}})),[]),T=styled.span(({theme:o})=>({fontFamily:o.typography.fonts.mono,fontWeight:o.typography.weight.bold,fontSize:o.typography.size.s1}));return useLayoutEffect(()=>{let o=document.querySelector("#storybook-panel-root");if(!o)return;let d=()=>{if(t!==void 0||!o)return;let A=window.innerHeight,Ge=B.current?.getBoundingClientRect().top||0,_e=A-Ge-40;h(_e);};setTimeout(()=>{d();});let u=new ResizeObserver(d);return u.observe(o),()=>u.disconnect()},[]),i.createElement(y,{ref:B},i.createElement(v,{style:{height:`${C.getTotalSize()+(M.current?.getBoundingClientRect().height||0)}px`,position:"relative"}},i.createElement("thead",{className:"docblock-argstable-head",ref:M,style:{height:"28px"}},i.createElement("tr",null,i.createElement("th",null,"Name"),n&&i.createElement("th",null,"Value"),i.createElement("th",null,"Preview"))),i.createElement("tbody",null,C.getVirtualItems().map(o=>{let d=k[o.index];return i.createElement("tr",{key:o.index,ref:u=>{u&&P.current.set(o.index,u);},onContextMenu:u=>E(u,{token:d,index:o.index}),style:{position:"absolute",top:0,left:0,width:"100%",height:`${o.size}px`,transform:`translateY(${o.start+(M.current?.getBoundingClientRect().height||0)}px)`}},i.createElement("td",null,i.createElement("span",null,i.createElement(T,null,d.name),i.createElement(WithTooltip,{hasChrome:!1,tooltip:i.createElement(TooltipNote,{note:"Copy to clipboard"})},i.createElement(V,{button:i.createElement(w,null,i.createElement(CopyIcon,null)),value:d.name})),d.description&&i.createElement(WithTooltip,{tooltip:i.createElement(TooltipMessage,{desc:d.description})},i.createElement(w,null,i.createElement(InfoIcon,null))))),n&&i.createElement("td",null,i.createElement(z,{key:d.name,onValueChange:u=>{m(A=>({...A,[d.name]:u===d.rawValue?void 0:u}));},readonly:r,token:d})),i.createElement("td",null,i.createElement(F,{presenters:a,token:{...d,value:g[d.name]||d.value}})))}))),b&&s&&createPortal(i.createElement(D,{ref:x,style:{top:b.top,left:b.left}},s[b.tokenName]?i.createElement(i.Fragment,null,i.createElement("div",null,"Used in:"),i.createElement("ul",null,s[b.tokenName].map((o,d)=>i.createElement("li",{key:d},o)))):i.createElement("div",null,"Token might be unused or global, please check")),document.body))};var ut=styled.div(({theme:e})=>({display:"flex",flexDirection:"column",position:"relative","&:focus-within svg":{color:e.color.defaultText}})),ct=styled(SearchIcon)(({theme:e})=>({width:12,height:12,position:"absolute",top:10,left:10,zIndex:1,pointerEvents:"none",color:e.textMutedColor})),ft=styled.button(({theme:e})=>({width:16,height:16,padding:4,position:"absolute",top:8,right:8,zIndex:1,background:"rgba(0,0,0,0.1)",border:"none",borderRadius:16,color:e.color.defaultText,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"})),gt=styled(O)(({theme:e})=>({paddingLeft:28,paddingRight:28,height:32}));function Ae({value:e,onChange:t,style:r}){let n=useCallback(p=>{t(p.target.value);},[t]),a=useCallback(()=>{t("");},[t]);return i.createElement(ut,{className:"token-search",style:r},i.createElement(ct,null),i.createElement(gt,{value:e,onChange:n,placeholder:"Provide a token name \u2026"}),i.createElement(ft,{onClick:a},i.createElement(CrossIcon,null)))}function He(e,t){let[r,n]=useState(e);return useEffect(()=>{let a=setTimeout(()=>{n(e);},t);return ()=>{clearTimeout(a);}},[e,t]),r}function Ve(e){let[t,r]=useState(""),n=He(t,250);return {categories:useMemo(()=>n?e?.map(p=>({...p,tokens:p.tokens.filter(f=>f.name.includes(n))})):e,[n,e]),searchText:t,setSearchText:r}}function Fe({categories:e,viewType:t="table",showSearch:r=!0,pageSize:n,presenters:a}){let{searchText:p,setSearchText:f,categories:s}=Ve(e);return i.createElement("div",null,r&&i.createElement(Ae,{value:p,onChange:f,style:{margin:"12px 12px 8px"}}),t==="card"&&i.createElement(we,{categories:s,pageSize:n,presenters:a}),t==="table"&&i.createElement(Ne,{categories:s,presenters:a}))}function Oe(e){let[t,r]=useState(),[n,a]=useState([]),[p,f]=useState([]),[s,g]=useState([]),[m,c]=useState([]),[h,P]=useState([]),[b,x]=useState(),[E,B]=useLocalStorage("storybook-design-token-addon-card",!1),[M,k]=useState(""),C=useMemo(()=>{let y=[...n,...p,...s,...m,...h].filter(o=>o!==void 0&&o?.tokens.length>0),T=Array.from(new Set(y.map(o=>o?.name))).map(o=>({label:o,categories:y.filter(d=>d?.name===o)}));return (e?.tabs??[]).length!==0&&(T=T.filter(o=>e.tabs.includes(o.label))),T},[n,p,s,m,h,e]);return useEffect(()=>{async function y(){let v=await(await fetch("./design-tokens.source.json")).text();r(JSON.parse(v));}y();},[]),useEffect(()=>{let y=t?.cssTokens,v=t?.lessTokens,T=t?.scssTokens,o=t?.svgTokens,d=t?.imageTokens;k(e?.styleInjection||""),y&&(a(y.categories),k(u=>u+y.injectionStyles)),v&&(f(v.categories),k(u=>u+v.injectionStyles)),T&&(g(T.categories),k(u=>u+T.injectionStyles)),o&&c(o.categories),d&&P(d.categories);},[e,t]),useEffect(()=>{e?.defaultTab&&C.find(y=>y.label===e.defaultTab)?x(e.defaultTab):C.length>0&&x(C[0].label);},[e,C]),{activeCategory:b,cardView:E,setActiveCategory:x,setCardView:B,styleInjections:M,tabs:C}}var ze=e=>{let t=useParameter("designToken"),{activeCategory:r,cardView:n,setActiveCategory:a,setCardView:p,styleInjections:f,tabs:s}=Oe(t),g=(s??[]).map(m=>m.label).join("-");return i.createElement(AddonPanel,{...e},i.createElement(i.Fragment,null,i.createElement("style",null,f),i.createElement(ScrollArea,{vertical:!0,horizontal:!0},i.createElement(Tabs,{key:g,actions:{onSelect:m=>a(m)},selected:r},s.map(m=>i.createElement("div",{key:m.label,id:m.label,title:m.label},r===m.label&&i.createElement(Fe,{categories:m.categories,viewType:n?"card":"table",showSearch:t?.showSearch,pageSize:t?.pageSize,presenters:{}}))))),i.createElement(ActionBar,{key:"actionbar",actionItems:[{onClick:()=>{p(!n);},title:n?"Table View":"Card View"}]})))};var L="storybook-design-token",$e=`${L}/panel`,We="designToken";addons.register(L,()=>{addons.add($e,{type:types.PANEL,title:"Design Tokens",paramKey:We,match:({viewMode:e})=>e==="story",render:({active:e})=>e?i.createElement(ze,{active:e}):null});});
//# sourceMappingURL=out.js.map
//# sourceMappingURL=manager.mjs.map