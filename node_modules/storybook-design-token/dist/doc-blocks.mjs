import i, { useMemo, useState, useEffect, useCallback, useRef, useLayoutEffect } from 'react';
import { styled, keyframes } from 'storybook/theming';
import { useLocalStorage, useCopyToClipboard } from '@uidotdev/usehooks';
import { SearchIcon, CrossIcon, CopyIcon, InfoIcon, CloseIcon } from '@storybook/icons';
import { WithTooltip, TooltipNote, TooltipMessage, Button } from 'storybook/internal/components';
import { createPortal } from 'react-dom';
import { transparentize } from 'polished';
import { useVirtualizer } from '@tanstack/react-virtual';

function K(e,t){let[r,n]=useState(e);return useEffect(()=>{let l=setTimeout(()=>{n(e);},t);return ()=>{clearTimeout(l);}},[e,t]),r}function Q(e){let[t,r]=useState(""),n=K(t,250);return {categories:useMemo(()=>n?e?.map(m=>({...m,tokens:m.tokens.filter(f=>f.name.includes(n))})):e,[n,e]),searchText:t,setSearchText:r}}function R(e){let[t,r]=useState(),[n,l]=useState([]),[m,f]=useState([]),[s,c]=useState([]),[g,p]=useState([]),[h,y]=useState([]),[b,P]=useState(),[B,I]=useLocalStorage("storybook-design-token-addon-card",!1),[M,k]=useState(""),C=useMemo(()=>{let x=[...n,...m,...s,...g,...h].filter(o=>o!==void 0&&o?.tokens.length>0),T=Array.from(new Set(x.map(o=>o?.name))).map(o=>({label:o,categories:x.filter(d=>d?.name===o)}));return (e?.tabs??[]).length!==0&&(T=T.filter(o=>e.tabs.includes(o.label))),T},[n,m,s,g,h,e]);return useEffect(()=>{async function x(){let v=await(await fetch("./design-tokens.source.json")).text();r(JSON.parse(v));}x();},[]),useEffect(()=>{let x=t?.cssTokens,v=t?.lessTokens,T=t?.scssTokens,o=t?.svgTokens,d=t?.imageTokens;k(e?.styleInjection||""),x&&(l(x.categories),k(u=>u+x.injectionStyles)),v&&(f(v.categories),k(u=>u+v.injectionStyles)),T&&(c(T.categories),k(u=>u+T.injectionStyles)),o&&p(o.categories),d&&y(d.categories);},[e,t]),useEffect(()=>{e?.defaultTab&&C.find(x=>x.label===e.defaultTab)?P(e.defaultTab):C.length>0&&P(C[0].label);},[e,C]),{activeCategory:b,cardView:B,setActiveCategory:P,setCardView:I,styleInjections:M,tabs:C}}var V=styled.input(({theme:e})=>({appearance:"none",background:e.input.background,border:"0 none",borderRadius:e.input.borderRadius,boxShadow:`${e.input.border} 0 0 0 1px inset`,boxSizing:"inherit",color:e.input.color||"inherit",display:" block",fontSize:e.typography.size.s2-1,lineHeight:"20px",margin:" 0",padding:"6px 10px",position:"relative",transition:"all 200ms ease-out",width:"100%","&:focus":{boxShadow:`${e.color.secondary} 0 0 0 1px inset`,outline:"none"},"&[disabled]":{cursor:"not-allowed",opacity:.5},"&:-webkit-autofill":{WebkitBoxShadow:`0 0 0 3em ${e.color.lightest} inset`},"::placeholder":{color:e.color.mediumdark}}));var Xe=styled.div(({theme:e})=>({display:"flex",flexDirection:"column",position:"relative","&:focus-within svg":{color:e.color.defaultText}})),qe=styled(SearchIcon)(({theme:e})=>({width:12,height:12,position:"absolute",top:10,left:10,zIndex:1,pointerEvents:"none",color:e.textMutedColor})),Ze=styled.button(({theme:e})=>({width:16,height:16,padding:4,position:"absolute",top:8,right:8,zIndex:1,background:"rgba(0,0,0,0.1)",border:"none",borderRadius:16,color:e.color.defaultText,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"})),Je=styled(V)(({theme:e})=>({paddingLeft:28,paddingRight:28,height:32}));function oe({value:e,onChange:t,style:r}){let n=useCallback(m=>{t(m.target.value);},[t]),l=useCallback(()=>{t("");},[t]);return i.createElement(Xe,{className:"token-search",style:r},i.createElement(qe,null),i.createElement(Je,{value:e,onChange:n,placeholder:"Provide a token name \u2026"}),i.createElement(Ze,{onClick:l},i.createElement(CrossIcon,null)))}var O=({button:e,value:t})=>{let[r,n]=useCopyToClipboard();return i.createElement("span",{onClick:()=>n(t)},e)};var re=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:r.color.secondary,borderRadius:2,height:32,width:"100%"})),[e]);return i.createElement("div",{style:{overflow:"hidden"}},i.createElement(t,{style:{animation:e.value}}))};var ne=({token:e})=>{let t=useMemo(()=>styled.div(()=>({border:e.value,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var le=({token:e})=>{let t=useMemo(()=>styled.div(()=>({minHeight:32,height:32,overflow:"auto"})),[]),r=useMemo(()=>styled.div(({theme:n})=>({background:n.color.secondary,borderRadius:e.value,minHeight:`calc(${e.value} * 2)`,minWidth:`calc(${e.value} * 2)`,overflow:"hidden",width:"100%"})),[e]);return i.createElement(t,null,i.createElement(r,null))};var pe=({token:e})=>{let t=useMemo(()=>styled.div(()=>({background:e.value,borderRadius:2,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var me=({token:e})=>{let t=keyframes`
    0% {
      transform: scaleX(0);
    }
    50% {
      transform: scaleX(1);
    }
    100% {
      transform: scaleX(0);
    }
  `,r=useMemo(()=>styled.div(({theme:n})=>({animation:`${t} 2s infinite`,animationTimingFunction:e.value,background:n.color.secondary,borderRadius:2,height:32,transformOrigin:"left",width:"100%"})),[e]);return i.createElement(r,null)};var de=()=>{let e=useMemo(()=>styled.div(({theme:t})=>({alignItems:"center",color:t.color.mediumdark,display:"flex",height:32,width:"100%"})),[]);return i.createElement(e,null,"No preview available.")};var ue=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontFamily:e.value,width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var ce=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontSize:e.value,height:e.value,lineHeight:1,whiteSpace:"nowrap",width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var fe=({token:e})=>{let t=useMemo(()=>styled.div(()=>({fontWeight:e.value,width:"100%"})),[e]);return i.createElement(t,null,"Lorem ipsum")};var ge=({token:e})=>{let t=useMemo(()=>styled.div(()=>({height:"100%",lineHeight:e.value,overflow:"auto",width:"100%"})),[e]);return i.createElement(t,null,"Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ipsam veniam eum dicta.")};var he=({token:e})=>{let t=useMemo(()=>styled.div(()=>({height:"100%",letterSpacing:e.value,overflow:"auto",width:"100%"})),[e]);return i.createElement(t,null,"Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ipsam veniam eum dicta.")};var xe=({token:e})=>{let t=useMemo(()=>styled.div(()=>({display:"flex",height:"2rem",width:"100%"})),[e]),r=useMemo(()=>styled.div(()=>({backgroundColor:"#000",borderRadius:"50%",height:"2rem",opacity:e.value,width:"2rem","&:nth-of-type(2)":{transform:"translateX(-50%)"}})),[e]);return i.createElement(t,null,i.createElement(r,null),i.createElement(r,null))};var Te=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:"#fff",boxShadow:e.value,height:32,width:"100%"})),[e]);return i.createElement(t,null)};var Pe=({token:e})=>{let t=useMemo(()=>styled.div(({theme:r})=>({background:r.color.secondary,borderRadius:2,height:32,width:e.value})),[e]);return i.createElement(t,null)};var ve=({token:e})=>{let t=useMemo(()=>styled.div(()=>({alignItems:"center",display:"flex",height:32,width:"100%"})),[e]);return i.createElement(t,{dangerouslySetInnerHTML:{__html:e.value}})};function Ce({token:e}){let t=useMemo(()=>styled.img(()=>({maxHeight:32,maxWidth:"100%",backgroundSize:"contain"})),[e]);return i.createElement(t,{src:`data:image/png;base64, ${e.value}`})}var z=({token:e,presenters:t})=>{let r=e.presenter,n={..._o,...t||{}},l=r!=null?n[r]:de;return i.createElement(l,{token:e})},_o={[`${"Animation"}`]:re,[`${"Border"}`]:ne,[`${"BorderRadius"}`]:le,[`${"Color"}`]:pe,[`${"Easing"}`]:me,[`${"FontFamily"}`]:ue,[`${"FontSize"}`]:ce,[`${"FontWeight"}`]:fe,[`${"LineHeight"}`]:ge,[`${"LetterSpacing"}`]:he,[`${"Opacity"}`]:xe,[`${"Shadow"}`]:Te,[`${"Spacing"}`]:Pe,[`${"Svg"}`]:ve,[`${"Image"}`]:Ce};var S=({children:e,onClick:t})=>{let r=useMemo(()=>styled.button(({theme:n})=>({alignItems:"center",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"inline-flex",height:18,justifyContent:"center",marginLeft:4,padding:0,verticalAlign:"middle",width:18,color:n.color.defaultText,"&:hover":{color:n.color.secondary},"> svg":{height:13,position:"relative",top:-1,width:13}})),[]);return i.createElement(r,{onClick:t},e)};var A=({onValueChange:e,readonly:t,token:r})=>{let[n,l]=useState(r.rawValue),m=useMemo(()=>styled.div(({})=>({position:"relative"})),[]),f=useMemo(()=>styled.span(({})=>({position:"absolute",right:8,top:"50%",transform:"translate3d(0, -50%, 0)"})),[]),s=useMemo(()=>styled.span(({})=>({overflow:"hidden",wordBreak:"break-all",WebkitLineClamp:3,WebkitBoxOrient:"vertical",display:"-webkit-box"})),[]),c=r.sourceType!=="CSS"&&r.sourceType!=="SVG";return useEffect(()=>{let p=document.querySelector("#storybook-preview-iframe")?.contentWindow?.document.documentElement;p!=null&&(r.rawValue!==n?p.style.setProperty(r.name,n):p.style.setProperty(r.name,r.rawValue));},[n]),i.createElement(m,null,c&&i.createElement(s,{title:n},n),!c&&i.createElement(V,{readOnly:t,onChange:g=>{let p=g.target.value;l(p),e(p);},value:n}),!c&&r.rawValue!==n&&i.createElement(f,null,i.createElement(S,{onClick:()=>{l(r.rawValue),e(r.rawValue);}},i.createElement(CloseIcon,null))))};var D=(e,t,r)=>useMemo(()=>{let n=e.flatMap(s=>s.tokens),l=r?n.filter(s=>s.sourcePath.includes(r)):n;return (t?l.filter(s=>t.includes(s.name)):l).filter((s,c,g)=>g.findIndex(p=>p.name===s.name)===c)},[e,t,r]);var Ro=keyframes({from:{opacity:0,transform:"translateY(5px)"},to:{opacity:1,transform:"translateY(0)"}}),W=styled.div(({theme:e})=>({position:"absolute",background:e.background.content,border:`1px solid ${e.color.border}`,borderRadius:e.borderRadius,padding:"12px 15px",boxShadow:`0 4px 12px ${transparentize(.85,e.color.darker)}`,color:e.color.defaultText,fontFamily:e.typography.fonts.base,fontSize:e.typography.size.s2,minWidth:150,maxWidth:300,zIndex:1e3,animation:`${Ro} 0.2s ease-out`,"& > div:first-child":{fontWeight:e.typography.weight.bold,marginBottom:8,color:e.color.darkest},"& > ul":{margin:0,padding:0,listStyle:"none",maxHeight:200,overflowY:"auto","& > li":{padding:"4px 8px",borderRadius:e.borderRadius/2,color:transparentize(.1,e.color.defaultText),background:transparentize(.95,e.color.medium),marginBottom:4,transition:"background 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","&:hover":{background:transparentize(.85,e.color.medium)},"&:last-child":{marginBottom:0}}}}));function G({usageMap:e,getElementRef:t,getTokenName:r}){let[n,l]=useState(null),m=useRef(null),f=useRef(null),s=useCallback((g,p)=>{let h=r(p);if(!e)return;g.preventDefault();let y=t(p);if(!y)return;let b=y.getBoundingClientRect(),P=b.bottom+window.scrollY+5,B=b.left+window.scrollX;l({top:P,left:B,tokenName:h}),m.current&&clearTimeout(m.current);},[e,t,r]),c=useCallback(()=>{l(null),m.current&&clearTimeout(m.current);},[]);return useLayoutEffect(()=>{let g=h=>{f.current&&!f.current.contains(h.target)&&c();},p=h=>{if(!n)return;let y=h.target;f.current&&!f.current.contains(y)&&(m.current&&clearTimeout(m.current),m.current=window.setTimeout(c,2e3));};return document.addEventListener("click",g),document.addEventListener("scroll",p,!0),()=>{document.removeEventListener("click",g),document.removeEventListener("scroll",p,!0);}},[n,c]),{popup:n,popupRef:f,handleContextMenu:s,closePopup:c}}var Me=({categories:e,padded:t=!0,readonly:r,showValueColumn:n=!0,pageSize:l=50,presenters:m,filterNames:f,usageMap:s,theme:c})=>{let[g,p]=useState({}),[h,y]=useState(0),b=useRef(new Map),{popup:P,popupRef:B,handleContextMenu:I}=G({usageMap:s,getElementRef:o=>b.current.get(o.name)||null,getTokenName:o=>o.name}),M=useMemo(()=>styled.div(()=>({display:"grid",columnGap:12,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",padding:t?15:void 0,rowGap:12})),[]),k=useMemo(()=>styled.div(({theme:o})=>({boxShadow:"rgb(0 0 0 / 10%) 0px 1px 3px 1px, rgb(0 0 0 / 7%) 0px 0px 0px 1px",borderRadius:4,color:o.color.defaultText,fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,padding:12,overflow:"hidden",":hover":{backgroundColor:o.background.hoverable},"> *:not(:last-child)":{marginBottom:8},svg:{maxWidth:"100%",maxHeight:"100%"}})),[]),C=styled.span(({theme:o})=>({fontFamily:o.typography.fonts.mono,fontWeight:o.typography.weight.bold,fontSize:o.typography.size.s1})),x=useMemo(()=>styled.div(({theme:o})=>({alignItems:"center",color:o.color.defaultText,display:"flex",fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,justifyContent:"space-between",paddingRight:t?15:void 0,paddingBottom:t?48:void 0,paddingLeft:t?15:void 0,marginTop:8,"& > div":{display:"flex",gap:8}})),[]),v=D(e,f,c),T=useMemo(()=>Math.ceil(v.length/l),[v]);return i.createElement(i.Fragment,null,i.createElement(M,null,v.slice(h*l,h*l+l).map((o,d)=>i.createElement(k,{key:o.name+"-card-"+d,ref:u=>{u&&b.current.set(o.name,u);},onContextMenu:u=>I(u,o)},i.createElement("div",null,i.createElement(C,null,o.name),i.createElement(WithTooltip,{hasChrome:!1,tooltip:i.createElement(TooltipNote,{note:"Copy to clipboard"})},i.createElement(O,{button:i.createElement(S,null,i.createElement(CopyIcon,null)),value:o.name})),o.description&&i.createElement(WithTooltip,{tooltip:i.createElement(TooltipMessage,{desc:o.description})},i.createElement(S,null,i.createElement(InfoIcon,null)))),n&&i.createElement(A,{onValueChange:u=>{p(H=>({...H,[o.name]:u===o.rawValue?void 0:u}));},readonly:r,token:o}),i.createElement(z,{presenters:m,token:{...o,value:g[o.name]||o.value}})))),T>1&&i.createElement(x,null,i.createElement("span",null,"Page ",h+1," of ",T),i.createElement("div",null,i.createElement(Button,{disabled:h===0,onClick:()=>y(o=>Math.max(0,o-1)),tertiary:!0,small:!0},"Previous page"),i.createElement(Button,{disabled:h>=T-1,onClick:()=>y(o=>Math.min(o+1,T-1)),tertiary:!0,small:!0},"Next page"))),P&&s&&createPortal(i.createElement(W,{ref:B,style:{top:P.top,left:P.left}},s&&s[P.tokenName]?i.createElement(i.Fragment,null,i.createElement("div",null,"Used in:"),i.createElement("ul",null,s[P.tokenName].map((o,d)=>i.createElement("li",{key:d},o)))):i.createElement("div",null,"Token might be unused or global, please check")),document.body))};var Ve=({categories:e,maxHeight:t,readonly:r,showValueColumn:n=!0,presenters:l,filterNames:m,theme:f,usageMap:s})=>{let[c,g]=useState({}),[p,h]=useState(t||100),y=useRef(new Map),{popup:b,popupRef:P,handleContextMenu:B}=G({usageMap:s,getElementRef:o=>y.current.get(o.index)||null,getTokenName:o=>o.token.name}),I=useRef(null),M=useRef(null),k=D(e,m,f),C=useVirtualizer({count:k.length,getScrollElement:()=>I.current,estimateSize:useCallback(()=>49,[])}),x=useMemo(()=>styled.div(()=>({maxHeight:p?`${p+30}px`:"none",overflow:"auto",padding:"15px"})),[p]),v=useMemo(()=>styled.table(({theme:o})=>({borderCollapse:"collapse",borderSpacing:0,color:o.color.defaultText,fontFamily:o.typography.fonts.base,fontSize:o.typography.size.s1,minWidth:700,tableLayout:"fixed",textAlign:"left",width:"100%","thead > tr":{display:"flex"},"tbody > tr":{borderTop:`1px solid ${o.color.mediumlight}`,display:"flex",":first-of-type":{borderTopColor:o.color.medium},":last-of-type":{borderBottom:`1px solid ${o.color.mediumlight}`},":hover":{backgroundColor:o.background.hoverable}},tr:{":hover":{backgroundColor:"rgba(0,0,0, 0.1)"}},"td, th":{border:"none !important",textOverflow:"ellipsis",verticalAlign:"middle",":nth-of-type(1)":{flexBasis:"50%",flexGrow:1,flexShrink:0},":nth-of-type(2)":{flexBasis:"25%",flexGrow:0,flexShrink:0},":nth-of-type(3)":{flexBasis:"25%",flexGrow:0,flexShrink:0}},th:{color:o.base==="light"?transparentize(.25,o.color.defaultText):transparentize(.45,o.color.defaultText),paddingBottom:12,":not(:first-of-type)":{paddingLeft:15},":not(:last-of-type)":{paddingRight:15},":last-of-type":{width:200}},td:{overflow:"hidden",paddingBottom:8,paddingTop:8,alignItems:"center",":not(:first-of-type)":{paddingLeft:15},":not(:last-of-type)":{paddingRight:15},svg:{maxWidth:"100%",maxHeight:"100%"},span:{alignItems:"center",display:"flex",height:"100%"}}})),[]),T=styled.span(({theme:o})=>({fontFamily:o.typography.fonts.mono,fontWeight:o.typography.weight.bold,fontSize:o.typography.size.s1}));return useLayoutEffect(()=>{let o=document.querySelector("#storybook-panel-root");if(!o)return;let d=()=>{if(t!==void 0||!o)return;let H=window.innerHeight,Oe=I.current?.getBoundingClientRect().top||0,ze=H-Oe-40;h(ze);};setTimeout(()=>{d();});let u=new ResizeObserver(d);return u.observe(o),()=>u.disconnect()},[]),i.createElement(x,{ref:I},i.createElement(v,{style:{height:`${C.getTotalSize()+(M.current?.getBoundingClientRect().height||0)}px`,position:"relative"}},i.createElement("thead",{className:"docblock-argstable-head",ref:M,style:{height:"28px"}},i.createElement("tr",null,i.createElement("th",null,"Name"),n&&i.createElement("th",null,"Value"),i.createElement("th",null,"Preview"))),i.createElement("tbody",null,C.getVirtualItems().map(o=>{let d=k[o.index];return i.createElement("tr",{key:o.index,ref:u=>{u&&y.current.set(o.index,u);},onContextMenu:u=>B(u,{token:d,index:o.index}),style:{position:"absolute",top:0,left:0,width:"100%",height:`${o.size}px`,transform:`translateY(${o.start+(M.current?.getBoundingClientRect().height||0)}px)`}},i.createElement("td",null,i.createElement("span",null,i.createElement(T,null,d.name),i.createElement(WithTooltip,{hasChrome:!1,tooltip:i.createElement(TooltipNote,{note:"Copy to clipboard"})},i.createElement(O,{button:i.createElement(S,null,i.createElement(CopyIcon,null)),value:d.name})),d.description&&i.createElement(WithTooltip,{tooltip:i.createElement(TooltipMessage,{desc:d.description})},i.createElement(S,null,i.createElement(InfoIcon,null))))),n&&i.createElement("td",null,i.createElement(A,{key:d.name,onValueChange:u=>{g(H=>({...H,[d.name]:u===d.rawValue?void 0:u}));},readonly:r,token:d})),i.createElement("td",null,i.createElement(z,{presenters:l,token:{...d,value:c[d.name]||d.value}})))}))),b&&s&&createPortal(i.createElement(W,{ref:P,style:{top:b.top,left:b.left}},s[b.tokenName]?i.createElement(i.Fragment,null,i.createElement("div",null,"Used in:"),i.createElement("ul",null,s[b.tokenName].map((o,d)=>i.createElement("li",{key:d},o)))):i.createElement("div",null,"Token might be unused or global, please check")),document.body))};var yt=styled.div(({})=>({margin:"25px 0 40px","*":{boxSizing:"border-box"}})),bt=styled.div(()=>({boxShadow:"rgb(0 0 0 / 10%) 0px 1px 3px 1px, rgb(0 0 0 / 7%) 0px 0px 0px 1px",borderRadius:4})),xt=({filterNames:e,usageMap:t,categoryName:r,maxHeight:n=600,showValueColumn:l=!0,viewType:m="table",showSearch:f=!0,pageSize:s,presenters:c,theme:g})=>{let{tabs:p}=R({pageSize:s,showSearch:f,presenters:c}),h=useMemo(()=>p.find(y=>y.label===r),[r,p]);return h?i.createElement(Tt,{filterNames:e,usageMap:t,categories:h.categories,viewType:m,maxHeight:n,showValueColumn:l,showSearch:f,pageSize:s,presenters:c,theme:g}):null};function Tt({viewType:e,categories:t,maxHeight:r,showValueColumn:n,showSearch:l,pageSize:m,presenters:f,filterNames:s,usageMap:c,theme:g}){let{searchText:p,setSearchText:h,categories:y}=Q(t??[]);return i.createElement(yt,{className:"design-token-container"},l&&i.createElement(oe,{value:p,onChange:b=>{h(b);},style:{margin:"12px 0"}}),e==="table"&&i.createElement(bt,{className:"design-token-card"},i.createElement(Ve,{categories:y,maxHeight:r,readonly:!0,showValueColumn:n,presenters:f,filterNames:s,usageMap:c,theme:g})),e==="card"&&i.createElement(Me,{filterNames:s,usageMap:c,categories:y,padded:!1,readonly:!0,showValueColumn:n,pageSize:m,presenters:f,theme:g}))}

export { xt as DesignTokenDocBlock };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=doc-blocks.mjs.map