# GitHub Actions ì›Œí¬í”Œë¡œìš°: Figma ë””ìžì¸ í† í° ë™ê¸°í™”
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” Figma ë””ìžì¸ í† í°ì„ ìžë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ê³  ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

name: 'Figma Design Sync'

# ìˆ˜ë™ ì‹¤í–‰ ë˜ëŠ” ìŠ¤ì¼€ì¤„ ì‹¤í–‰
on:
  # ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
  workflow_dispatch:
    inputs:
      figma_file_key:
        description: 'Figma íŒŒì¼ í‚¤ (URLì—ì„œ ì¶”ì¶œ)'
        required: false
        default: '7YaZcmb7hUIj0nqV1o0T2E'
  
  # ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ìžë™ ì‹¤í–‰ (ì„ íƒì‚¬í•­) - í˜„ìž¬ ë¹„í™œì„±í™”
  # schedule:
  #   - cron: '0 9 * * *'

jobs:
  figma-sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ðŸ“¥ Install dependencies
        run: npm ci

      # Figma APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë””ìžì¸ í† í° ì¶”ì¶œ (ì„ íƒì‚¬í•­)
      - name: ðŸŽ¨ Extract Figma Design Tokens
        run: |
          echo "ðŸŽ¨ Figma ë””ìžì¸ í† í° ë™ê¸°í™”ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
          echo "Figma íŒŒì¼ í‚¤: ${{ github.event.inputs.figma_file_key || '7YaZcmb7hUIj0nqV1o0T2E' }}"
          
          # ì—¬ê¸°ì— Figma APIë¥¼ ì‚¬ìš©í•œ ë””ìžì¸ í† í° ì¶”ì¶œ ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
          # ì˜ˆ: figma-api-toolkitì´ë‚˜ style-dictionary ì‚¬ìš©
          
          # í˜„ìž¬ëŠ” ì˜ˆì‹œë¡œ ë””ìžì¸ í† í° íŒŒì¼ ìƒì„±
          mkdir -p src/design-tokens
          cat > src/design-tokens/colors.js << 'EOF'
          // Figmaì—ì„œ ìžë™ ìƒì„±ëœ ìƒ‰ìƒ í† í°
          export const colors = {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe', 
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8'
            },
            secondary: {
              50: '#f9fafb',
              100: '#f3f4f6',
              500: '#6b7280',
              600: '#4b5563',
              700: '#374151'
            }
          };
          EOF
          
          echo "âœ… ë””ìžì¸ í† í°ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."

      # ë³€ê²½ì‚¬í•­ì´ ìžˆìœ¼ë©´ ìžë™ ì»¤ë°‹
      - name: ðŸ“ Commit design token updates
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          if [[ -n $(git status --porcelain) ]]; then
            git add src/design-tokens/
            git commit -m "chore: Update design tokens from Figma

            - Auto-generated from Figma API
            - Updated color palette and design tokens
            - Synced at $(date -u +"%Y-%m-%d %H:%M:%S UTC")"
            git push
            echo "âœ… ë””ìžì¸ í† í° ë³€ê²½ì‚¬í•­ì´ ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤."
          else
            echo "â„¹ï¸ ë³€ê²½ëœ ë””ìžì¸ í† í°ì´ ì—†ìŠµë‹ˆë‹¤."
          fi

      # Storybook ìž¬ë¹Œë“œ ë° ë°°í¬ íŠ¸ë¦¬ê±°
      - name: ðŸ”„ Trigger Storybook rebuild
        if: success()
        run: |
          echo "ðŸ”„ Storybook ìž¬ë¹Œë“œë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤..."
          # ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•˜ê±°ë‚˜ ì§ì ‘ ë¹Œë“œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

  # ë””ìžì¸ í† í° ê²€ì¦ ìž‘ì—…
  validate-design-tokens:
    runs-on: ubuntu-latest
    needs: figma-sync
    
    steps:
      - name: ðŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ðŸ“¥ Install dependencies
        run: npm ci

      # ë””ìžì¸ í† í° ìœ íš¨ì„± ê²€ì‚¬
      - name: âœ… Validate design tokens
        run: |
          echo "âœ… ë””ìžì¸ í† í° ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤..."
          
          # ë””ìžì¸ í† í° íŒŒì¼ì´ ì¡´ìž¬í•˜ëŠ”ì§€ í™•ì¸
          if [ -f "src/design-tokens/colors.js" ]; then
            echo "âœ… ìƒ‰ìƒ í† í° íŒŒì¼ì´ ì¡´ìž¬í•©ë‹ˆë‹¤."
            
            # Node.jsë¡œ íŒŒì¼ êµ¬ë¬¸ ê²€ì‚¬
            node -c src/design-tokens/colors.js
            echo "âœ… ìƒ‰ìƒ í† í° íŒŒì¼ êµ¬ë¬¸ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤."
          else
            echo "âš ï¸ ìƒ‰ìƒ í† í° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
          fi

      # Storybookì—ì„œ ë””ìžì¸ í† í° ì‚¬ìš© í™•ì¸
      - name: ðŸ§ª Test design tokens in Storybook
        run: |
          echo "ðŸ§ª Storybookì—ì„œ ë””ìžì¸ í† í° ì‚¬ìš©ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤..."
          npm run build-storybook
          echo "âœ… Storybook ë¹Œë“œê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤."
